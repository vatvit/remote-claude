---
title: Host-side bridge to local Claude CLI
status: completed
type: feature
priority: critical
epic: remote-control
---

## Workflow

| # | Step | Status | Notes |
|---|------|--------|-------|
| 10 | Requirements | done | Bash bridge, streaming, port 8886 |
| 20 | Assessment | done | claude -p --output-format stream-json, --resume |
| 30 | Architecture | done | See below |
| 40 | Tests | skipped | |
| 50 | Subtasks | skipped | |
| 60 | Implementation | done | Python bridge + server.js updated |
| 70 | Tech Debt | skipped | |
| 80 | Reflection | done | |

## Description

A lightweight bridge script running on the host machine that receives commands from the Docker container and forwards them to the locally authenticated `claude` CLI.

**Port scheme:**
- 8888 — Remote client UI (Express in Docker)
- 8887 — Host admin UI (RCL-009)
- 8886 — Host bridge (this task)

**Architecture:**
```
[Docker: Express :8888] --HTTP POST--> [Host: bridge :8886] --stdin/stdout--> [host's claude CLI]
                        <--response---                      <--output--------
```

**How it works:**
- Small Node.js (or bash) HTTP server running directly on the host (NOT in Docker)
- Listens on port 8886
- Receives `POST /command` with `{ "command": "...", "cwd": "/path" }`
- Spawns `claude --print` (or `claude -p`) with the command as stdin
- Returns Claude's output as the response
- Supports session continuity (pass session ID, use `--resume`)

**Why on host:**
- The host machine has Claude Code authenticated via subscription (macOS Keychain)
- No need for API keys or container auth
- Bridge is the only component that runs outside Docker

**Deliverables:**
- `bridge/bridge.js` (or `bridge.sh`) — the bridge script
- Instructions to run it on the host
- Update `server.js` to call bridge instead of SDK directly
- Remove `@anthropic-ai/claude-agent-sdk` dependency from Docker (no longer needed there)

**Questions to clarify during implementation:**
- Use Node.js or plain bash+curl for the bridge? (Node.js is simpler for HTTP + child process)
- Should the bridge support streaming (chunked response)?
- How does `claude --print` handle session resume? (check CLI flags)
- Should the bridge run as a background service or just `node bridge.js`?
- Exception: Node.js rule ("never run node on host") — bridge is the intentional exception since it needs host-level auth access
